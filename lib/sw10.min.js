/**
* SignWriting 2010 JavaScript Library v1.7.0
* https://github.com/Slevinski/sw10js
* Copyright (c) 2007-2015, Stephen E Slevinski Jr
* sw10.min.js is released under the MIT License.
*/
var sw10={key:function(e,t){var a=e.match(/S[123][0-9a-f]{2}[0-5][0-9a-f]([0-9]{3}x[0-9]{3})?/g);return a?a[0]+(t?this.styling(e):""):""},fsw:function(e,t){var a=e.match(/(A(S[123][0-9a-f]{2}[0-5][0-9a-f])+)?[BLMR]([0-9]{3}x[0-9]{3})(S[123][0-9a-f]{2}[0-5][0-9a-f][0-9]{3}x[0-9]{3})*|S38[7-9ab][0-5][0-9a-f][0-9]{3}x[0-9]{3}/);return a?a[0]+(t?this.styling(e):""):""},styling:function(e){var t=e.match(/-C?(P[0-9]{2})?(G_([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+)_)?(D_([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+)(,([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+))?_)?(Z([0-9]+(\.[0-9]+)?|x))?(-(D[0-9]{2}_([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+)(,([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+))?_)*(Z[0-9]{2},[0-9]+(\.[0-9]+)?(,[0-9]{3}x[0-9]{3})?)*)?/);return t?t[0]:""},mirror:function(e){if(e=this.key(e),!this.size(e))return"";var t,a=e.slice(0,4),r=e.slice(4,5),s=parseInt(e.slice(5,6),16),i=a+"08",n=a+"18";for(this.size(i)||this.size(n)?t=8:((0===s||4==s)&&(t=0),(1==s||5==s)&&(t=6),(2==s||6==s)&&(t=4),(3==s||7==s)&&(t=2)),e="";!this.size(e);)s+=t,s>7&&8>t&&(s-=8),s>15&&(s-=16),e=a+r+s.toString(16);return e},fill:function(e,t){if(e=this.key(e),!this.size(e))return"";-1!=t&&(t=1);var a=e.slice(0,4),r=parseInt(e.slice(4,5)),s=e.slice(5,6);for(e="";!this.size(e);)r+=t,r>5&&(r=0),0>r&&(r=5),e=a+r+s;return e},rotate:function(e,t){if(e=this.key(e),!this.size(e))return"";-1!=t&&(t=1);var a=e.slice(0,4),r=e.slice(4,5),s=parseInt(e.slice(5,6),16);for(e="";!this.size(e);)s>7?(s+=t,s>15&&(s=8),8>s&&(s=15),e=a+r+s.toString(16)):(s-=t,s>7&&(s=0),0>s&&(s=7),e=a+r+s);return e},scroll:function(e,t){if(e=this.key(e),!this.size(e))return"";-1!=t&&(t=1);var a=parseInt(e.slice(1,4),16)+t,r=e.slice(4,5),s=e.slice(5,6),i="S"+a.toString(16)+r+s;return this.size(i)?i:e},structure:function(e,t,a){var r={kind:["S100","S37f","S387"],category:["S100","S205","S2f7","S2ff","S36d","S37f","S387"],group:["S100","S10e","S11e","S144","S14c","S186","S1a4","S1ba","S1cd","S1f5","S205","S216","S22a","S255","S265","S288","S2a6","S2b7","S2d5","S2e3","S2f7","S2ff","S30a","S32a","S33b","S359","S36d","S376","S37f","S387"]},s=r[e];if(!s)return t?"is"==a?!1:"":[];if(!t&&!a)return s;a||(a="");var i;switch(a){case"is":return-1==s.indexOf(t.slice(0,4))?!1:!0;case"first":return s[0];case"last":return s.slice(-1)[0];case"prev":i=-2;break;case"":i=-1;break;case"next":i=0;break;default:return""}var n,f=s.length;for(n=0;n<s.length;n++)if(parseInt(t.slice(1,4),16)<parseInt(s[n].slice(1,4),16)){f=n;break}return f+=i,f=0>f?0:f>=s.length?s.length-1:f,s[f]},type:function(e){var t,a;switch(e){case"writing":t="100",a="37e";break;case"hand":t="100",a="204";break;case"movement":t="205",a="2f6";break;case"dynamic":t="2f7",a="2fe";break;case"head":case"hcenter":t="2ff",a="36c";break;case"vcenter":t="2ff",a="375";break;case"trunk":t="36d",a="375";break;case"limb":t="376",a="37e";break;case"location":t="37f",a="386";break;case"punctuation":t="387",a="38b";break;default:t="100",a="38b"}return[t,a]},is:function(e,t){if(6==e.length&&!this.size(e))return!1;var a=this.type(t),r=a[0],s=a[1],i=e.slice(1,4);return parseInt(r,16)<=parseInt(i,16)&&parseInt(s,16)>=parseInt(i,16)},filter:function(e,t){var a=this.type(t),r=a[0],s=a[1],i="S"+this.range(r,s,1)+"[0-5][0-9a-f][0-9]{3}x[0-9]{3}",n=e.match(new RegExp(i,"g"));return n?n.join(""):""},random:function(e){var t=this.type(e),a=t[0],r=t[1],s=Math.floor(Math.random()*(parseInt(r,16)-parseInt(a,16)+1)+parseInt(a,16)),i=Math.floor(6*Math.random()),n=Math.floor(16*Math.random()),f="S"+s.toString(16)+i.toString(16)+n.toString(16);return this.size(f)?f:this.random(e)},colorize:function(e){var t="000000";return this.is(e,"hand")&&(t="0000CC"),this.is(e,"movement")&&(t="CC0000"),this.is(e,"dynamic")&&(t="FF0099"),this.is(e,"head")&&(t="006600"),this.is(e,"location")&&(t="884411"),this.is(e,"punctuation")&&(t="FF9900"),t},view:function(e,t){if(!this.is(e))return"";var a=e.slice(0,4);return t?a+(this.size(a+"00")?"0":"1")+"0":a+(this.is(a,"hand")&&!this.structure("group",a,"is")?"1":"0")+"0"},code:function(e,t){var a,r,s=this.fsw(e);if(s){var i="S[123][0-9a-f]{2}[0-5][0-9a-f]",n=s.match(new RegExp(i,"g"));for(r=0;r<n.length;r++)a=n[r],s=s.replace(a,this.code(a,t));return s}if(a=this.key(e),!a)return"";var f=1048576+96*(parseInt(a.slice(1,4),16)-256)+16*parseInt(a.slice(4,5),16)+parseInt(a.slice(5,6),16)+1;return t?f.toString(16).toUpperCase():String.fromCharCode(55296+(f-65536>>10),56320+(f-65536&1023))},uni8:function(e,t){var a,r,s=this.fsw(e);if(s){var i="S[123][0-9a-f]{2}[0-5][0-9a-f]",n=s.match(new RegExp(i,"g"));for(r=0;r<n.length;r++)a=n[r],s=s.replace(a,this.uni8(a,t));return s}if(a=this.key(e),!a)return"";var f=parseInt(a.substr(1,3),16)+parseInt("1D700",16),c=t?f.toString(16).toUpperCase():String.fromCharCode(55296+(f-65536>>10),56320+(f-65536&1023)),l=a.substr(4,1);"0"!=l&&(l=parseInt(l,16)+parseInt("1DA9A",16),c+=t?l.toString(16).toUpperCase():String.fromCharCode(55296+(l-65536>>10),56320+(l-65536&1023)));var h=a.substr(5,1);return"0"!=h&&(h=parseInt(h,16)+parseInt("1DAA0",16),c+=t?h.toString(16).toUpperCase():String.fromCharCode(55296+(h-65536>>10),56320+(h-65536&1023))),c},pua:function(e,t){var a,r,s=this.fsw(e);if(s){var i,n,f;n=parseInt("FD800",16),s=s.replace("A",t?n.toString(16).toUpperCase():String.fromCharCode(55296+(n-65536>>10),56320+(n-65536&1023))),s=s.replace("B",t?(n+1).toString(16).toUpperCase():String.fromCharCode(55296+(n+1-65536>>10),56320+(n+1-65536&1023))),s=s.replace("L",t?(n+2).toString(16).toUpperCase():String.fromCharCode(55296+(n+2-65536>>10),56320+(n+2-65536&1023))),s=s.replace("M",t?(n+3).toString(16).toUpperCase():String.fromCharCode(55296+(n+3-65536>>10),56320+(n+3-65536&1023))),s=s.replace("R",t?(n+4).toString(16).toUpperCase():String.fromCharCode(55296+(n+4-65536>>10),56320+(n+4-65536&1023)));for(var c="[0-9]{3}x[0-9]{3}",l=s.match(new RegExp(c,"g")),h=0;h<l.length;h++)i=l[h],f=i.split("x"),f[0]=parseInt(f[0])+parseInt("FDD0C",16),f[1]=parseInt(f[1])+parseInt("FDD0C",16),r=t?f[0].toString(16).toUpperCase():String.fromCharCode(55296+(f[0]-65536>>10),56320+(f[0]-65536&1023)),r+=t?f[1].toString(16).toUpperCase():String.fromCharCode(55296+(f[1]-65536>>10),56320+(f[1]-65536&1023)),s=s.replace(i,r);for(c="S[123][0-9a-f]{2}[0-5][0-9a-f]",l=s.match(new RegExp(c,"g")),h=0;h<l.length;h++)a=l[h],s=s.replace(a,this.pua(a,t));return s}if(a=this.key(e),!a)return"";var p=parseInt(a.substr(1,3),16)+parseInt("FD730",16);r=t?p.toString(16).toUpperCase():String.fromCharCode(55296+(p-65536>>10),56320+(p-65536&1023));var o=a.substr(4,1);o=parseInt(o,16)+parseInt("FD810",16),r+=t?o.toString(16).toUpperCase():String.fromCharCode(55296+(o-65536>>10),56320+(o-65536&1023));var g=a.substr(5,1);return g=parseInt(g,16)+parseInt("FD820",16),r+=t?g.toString(16).toUpperCase():String.fromCharCode(55296+(g-65536>>10),56320+(g-65536&1023))},bbox:function(e){var t,a,r,s,i,n,f=/[0-9]{3}x[0-9]{3}/g,c=e.match(f);if(c){for(var l=0;l<c.length;l++)t=parseInt(c[l].slice(0,3)),a=parseInt(c[l].slice(4,7)),0===l?(r=t,s=t,i=a,n=a):(r=Math.min(r,t),s=Math.max(s,t),i=Math.min(i,a),n=Math.max(n,a));return""+r+" "+s+" "+i+" "+n}return""},displace:function(e,t,a){var r,s,i="[0-9]{3}x[0-9]{3}",n=e.match(new RegExp(i,"g"));if(n){for(var f=0;f<n.length;f++)r=parseInt(n[f].slice(0,3))+t,s=parseInt(n[f].slice(4,7))+a,e=e.replace(n[f],r+"X"+s);e=e.replace(/X/g,"x")}return e},sizes:{},size:function(e){var t,a,r,s,i=this.fsw(e);if(i){var n=this.bbox(i);n=n.split(" ");var f=n[0],c=n[1],l=n[2],h=n[3];return s=c-f+"x"+(h-l),"0x0"==s?"":s}var p=this.key(e);if(!p)return"";if(this.sizes[p])return this.sizes[p];var o,g,u=2,S=76*u;this.canvaser||(this.canvaser=document.createElement("canvas"),this.canvaser.width=S,this.canvaser.height=S);var d=this.canvaser,x=d.getContext("2d");x.clearRect(0,0,S,S),x.font=30*u+"px 'SignWriting 2010'",x.fillText(this.code(p),0,0),o=x.getImageData(0,0,S,S).data;e:for(t=S-1;t>=0;t--)for(a=0;S>a;a++)for(r=0;4>r;r++)if(g=4*t+4*a*S+r,o[g])break e;var b=t;e:for(a=S-1;a>=0;a--)for(t=0;b>t;t++)for(r=0;4>r;r++)if(g=4*t+4*a*S+r,o[g])break e;var I=a+1;if(b=""+Math.ceil(b/u),I=""+Math.ceil(I/u),"S1710d S1711d S1712d S17311 S17321 S17733 S1773f S17743 S1774f S17753 S1775f S16d33 S1713d S1714d S17301 S17329 S1715d".indexOf(p)>-1&&(b="20"),"S24c15 S24c30".indexOf(p)>-1&&(b="22"),"S2903b".indexOf(p)>-1&&(b="23"),"S1d203 S1d233".indexOf(p)>-1&&(b="25"),"S24c15".indexOf(p)>-1&&(b="28"),"S2e629".indexOf(p)>-1&&(b="29"),"S16541 S23425".indexOf(p)>-1&&(b="30"),"S2d316".indexOf(p)>-1&&(b="40"),"S2541a".indexOf(p)>-1&&(b="50"),"S1732f S17731 S17741 S17751".indexOf(p)>-1&&(I="20"),"S1412c".indexOf(p)>-1&&(I="21"),"S2a903".indexOf(p)>-1&&(I="31"),"S2b002".indexOf(p)>-1&&(I="36"),s=b+"x"+I,"0x0"==s){var v="S1000815x30 S1000921x30 S1000a30x15 S1000b30x21 S1000c15x30 S1000d21x30 ",m=v.indexOf(p);if(-1==m)return"";var k=v.indexOf(" ",m);s=v.slice(m+6,k)}return this.sizes[p]=s,s},max:function(e,t){var a=this.type(t),r=a[0],s=a[1],i="S"+this.range(r,s,1)+"[0-5][0-9a-f][0-9]{3}x[0-9]{3}",n=e.match(new RegExp(i,"g"));if(n){for(var f,c,l,h,p="",o=0;o<n.length;o++)f=n[o].slice(0,6),c=parseInt(n[o].slice(6,9)),l=parseInt(n[o].slice(10,13)),h=this.size(f).split("x"),p+=f+c+"x"+l+(c+parseInt(h[0]))+"x"+(l+parseInt(h[1]));return p}return""},norm:function(e){var t,a,r,s,i=this.bbox(this.max(e,"hcenter")),n=this.bbox(this.max(e,"vcenter")),f=this.bbox(this.max(e));if(!f)return"";n?(t=parseInt(n.slice(0,3)),a=parseInt(n.slice(4,7))):(t=parseInt(f.slice(0,3)),a=parseInt(f.slice(4,7))),i?(r=parseInt(i.slice(8,11)),s=parseInt(i.slice(12,15))):(r=parseInt(f.slice(8,11)),s=parseInt(f.slice(12,15)));var c=parseInt((t+a)/2),l=parseInt((r+s)/2),h=500-c,p=500-l,o=e.match(/(A(S[123][0-9a-f]{2}[0-5][0-9a-f])+)?[BLMR]/);return o=o?o[0]:"M",e=o+parseInt(f.slice(4,7))+"x"+parseInt(f.slice(12,15))+this.filter(e),this.displace(e,h,p)},svg:function(e,t){var a,r,s,i,n,f,c=this.fsw(e),l=this.styling(e);if(!c){var h=this.key(e);if(s=this.size(h),!s)return"";c=6==h.length?h+"500x500":h}if(t||(t={}),t.size=t.size?parseFloat(t.size)||"x":1,t.colorize=t.colorize?!0:!1,t.pad=t.pad?parseInt(t.pad):0,t.line=t.line?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.line)?"#"+t.line:t.line:"black",t.fill=t.fill?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.fill)?"#"+t.fill:t.fill:"white",t.back=t.back?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.back)?"#"+t.back:t.back:"",t.E=[],t.F=[],t.view="key"==t.view?"key":"uni8"==t.view?"uni8":"pua"==t.view?"pua":"code",t.copy="code"==t.copy?"code":"uni8"==t.copy?"uni8":"pua"==t.copy?"pua":"key",l){var p;if(p=l.match(/C/),t.colorize=p?!0:!1,p=l.match(/P[0-9]{2}/),p&&(t.pad=parseInt(p[0].substring(1,p[0].length))),p=l.match(/G_([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+)_/)){var o=p[0].substring(2,p[0].length-1);t.back=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(o)?"#"+o:o}if(a=l.split("-"),p=a[1].match(/D_([0-9a-f]{3}([0-9a-f]{3})?|[a-zA-Z]+)(,([0-9a-f]{3}([0-9a-f]{3})?|[a-zA-Z]+))?_/),p&&(i=p[0].substring(2,p[0].length-1).split(","),i[0]&&(t.line=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(i[0])?"#"+i[0]:i[0]),i[1]&&(t.fill=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(i[1])?"#"+i[1]:i[1])),p=a[1].match(/Z([0-9]+(\.[0-9]+)?|x)/),p&&(t.size=parseFloat(p[0].substring(1,p[0].length))||"x"),a[2]||(a[2]=""),p=a[2].match(/D[0-9]{2}_([0-9a-f]{3}([0-9a-f]{3})?|[a-wyzA-Z]+)(,([0-9a-f]{3}([0-9a-f]{3})?|[a-wyzA-Z]+))?_/g))for(n=0;n<p.length;n++)r=parseInt(p[n].substring(1,3)),i=p[n].substring(4,p[n].length-1).split(","),i[0]&&(i[0]=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(i[0])?"#"+i[0]:i[0]),i[1]&&(i[1]=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(i[1])?"#"+i[1]:i[1]),t.E[r]=i;if(p=a[2].match(/Z[0-9]{2},[0-9]+(\.[0-9]+)?(,[0-9]{3}x[0-9]{3})?/g))for(n=0;n<p.length;n++)r=parseInt(p[n].substring(1,3)),f=p[n].substring(4,p[n].length).split(","),f[0]=parseFloat(f[0]),t.F[r]=f}var g,u,S,d,x,b,I;g=/(A(S[123][0-9a-f]{2}[0-5][0-9a-f])+)?[BLMR]([0-9]{3}x[0-9]{3})(S[123][0-9a-f]{2}[0-5][0-9a-f][0-9]{3}x[0-9]{3})*|S38[7-9ab][0-5][0-9a-f][0-9]{3}x[0-9]{3}/g,u=/S[123][0-9a-f]{2}[0-5][0-9a-f][0-9]{3}x[0-9]{3}/g,S=/[0-9]{3}x[0-9]{3}/g,I={},I.L=-1,I.R=1;var v,m,k,F,w,A,z=500,y=500,C=500,M=500;k=c.charAt(0);var R=this.bbox(c);for(R=R.split(" "),z=parseInt(R[0]),y=parseInt(R[1]),C=parseInt(R[2]),M=parseInt(R[3]),"S"==k&&(500==z&&500==C?(f=s.split("x"),y=500+parseInt(f[0]),M=500+parseInt(f[1])):(y=1e3-z,M=1e3-C)),x=c.match(u),n=0;n<x.length;n++){if(d=x[n].slice(0,6),v=x[n].slice(6,9),m=x[n].slice(10,13),t.F[n+1]){t.F[n+1][1]&&(v=parseInt(v)+parseInt(t.F[n+1][1].slice(0,3))-500,m=parseInt(m)+parseInt(t.F[n+1][1].slice(4,7))-500,z=Math.min(z,v),C=Math.min(C,m));var E=this.size(d);E&&(E=E.split("x"),y=Math.max(y,parseInt(v)+t.F[n+1][0]*parseInt(E[0])),M=Math.max(M,parseInt(m)+t.F[n+1][0]*parseInt(E[1])))}b='<g transform="translate('+v+","+m+')">',b+="<text ",b+='class="sym-fill" ',t.css||(b+="style=\"pointer-events:none;font-family:'SignWriting 2010 Filling';font-size:"+(t.F[n+1]?30*t.F[n+1][0]:30)+"px;fill:"+(t.E[n+1]&&t.E[n+1][1]?t.E[n+1][1]:t.fill)+";",b+="code"==t.view?"":"-webkit-font-feature-settings:'liga';font-feature-settings:'liga';",b+='"'),b+=">",b+="key"==t.view?d:"uni8"==t.view?this.uni8(d):"pua"==t.view?this.pua(d):this.code(d),b+="</text>",b+="<text ",b+='class="sym-line" ',t.css||(b+='style="',b+=t.view==t.copy?"":"pointer-events:none;",b+="font-family:'SignWriting 2010';font-size:"+(t.F[n+1]?30*t.F[n+1][0]:30)+"px;fill:"+(t.E[n+1]?t.E[n+1][0]:t.colorize?"#"+this.colorize(d):t.line)+";",b+="code"==t.view?"":"-webkit-font-feature-settings:'liga';font-feature-settings:'liga';",b+='"'),b+=">",b+="key"==t.view?d:"uni8"==t.view?this.uni8(d):"pua"==t.view?this.pua(d):this.code(d),b+="</text>",b+="</g>",x[n]=b}z-=t.pad,y+=t.pad,C-=t.pad,M+=t.pad,F=y-z,w=M-C,A=I[k]||0,A=75*A+z-400;var O='<svg xmlns="http://www.w3.org/2000/svg" ';return t["class"]&&(O+='class="'+t["class"]+'" '),"x"!=t.size&&(O+='width="'+F*t.size+'" height="'+w*t.size+'" '),O+='viewBox="'+z+" "+C+" "+F+" "+w+'">',t.view!=t.copy&&(O+='<text style="font-size:0%;">',O+="code"==t.copy?this.code(e):"uni8"==t.copy?this.uni8(e):"pua"==t.copy?this.pua(e):e,O+="</text>"),t.back&&(O+='  <rect x="'+z+'" y="'+C+'" width="'+F+'" height="'+w+'" style="fill:'+t.back+';" />'),O+=x.join("")+"</svg>",t.laned&&(O='<div style="padding:10px;position:relative;width:'+F+"px;height:"+w+"px;left:"+A+'px;">'+O+"</div>"),O},canvas:function(e,t){var a,r,s,i,n,f,c,l=document.createElement("canvas"),h=this.fsw(e,!0),p=this.styling(e);if(!h){var o=this.key(e);if(s=this.size(o),!o)return"";h=6==o.length?o+"500x500":o}if(t||(t={}),t.size=t.size?parseFloat(t.size):1,t.colorize=t.colorize?!0:!1,t.pad=t.pad?parseInt(t.pad):0,t.line=t.line?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.line)?"#"+t.line:t.line:"black",t.fill=t.fill?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.fill)?"#"+t.fill:t.fill:"white",t.back=t.back?/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(t.back)?"#"+t.back:t.back:"",t.E=[],t.F=[],p){var g;if(g=p.match(/C/),t.colorize=g?!0:!1,g=p.match(/P[0-9]{2}/),g&&(t.pad=parseInt(g[0].substring(1,g[0].length))),g=p.match(/G_([0-9a-fA-F]{3}([0-9a-fA-F]{3})?|[a-zA-Z]+)_/)){var u=g[0].substring(2,g[0].length-1);t.back=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(u)?"#"+u:u}if(a=p.split("-"),g=a[1].match(/D_([0-9a-f]{3}([0-9a-f]{3})?|[a-zA-Z]+)(,([0-9a-f]{3}([0-9a-f]{3})?|[a-zA-Z]+))?_/),g&&(r=g[0].substring(2,g[0].length-1).split(","),r[0]&&(t.line=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(r[0])?"#"+r[0]:r[0]),r[1]&&(t.fill=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(r[1])?"#"+r[1]:r[1])),g=a[1].match(/Z[0-9]+(\.[0-9]+)?/),g&&(t.size=g[0].substring(1,g[0].length)),a[2]||(a[2]=""),g=a[2].match(/D[0-9]{2}_([0-9a-f]{3}([0-9a-f]{3})?|[a-wyzA-Z]+)(,([0-9a-f]{3}([0-9a-f]{3})?|[a-wyzA-Z]+))?_/g))for(f=0;f<g.length;f++)c=parseInt(g[f].substring(1,3)),r=g[f].substring(4,g[f].length-1).split(","),r[0]&&(r[0]=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(r[0])?"#"+r[0]:r[0]),r[1]&&(r[1]=/^[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/g.test(r[1])?"#"+r[1]:r[1]),t.E[c]=r;if(g=a[2].match(/Z[0-9]{2},[0-9]+(\.[0-9]+)?(,[0-9]{3}x[0-9]{3})?/g))for(f=0;f<g.length;f++)c=parseInt(g[f].substring(1,3)),n=g[f].substring(4,g[f].length).split(","),n[0]=parseFloat(n[0]),t.F[c]=n}var S,d,x,b,I,v;S=/(A(S[123][0-9a-f]{2}[0-5][0-9a-f])+)?[BLMR]([0-9]{3}x[0-9]{3})(S[123][0-9a-f]{2}[0-5][0-9a-f][0-9]{3}x[0-9]{3})*|S38[7-9ab][0-5][0-9a-f][0-9]{3}x[0-9]{3}/g,d=/S[123][0-9a-f]{2}[0-5][0-9a-f][0-9]{3}x[0-9]{3}/g,x=/[0-9]{3}x[0-9]{3}/g,v={},v.L=-1,v.R=1;var m,k,F,w,A,z=500,y=500,C=500,M=500;F=h.charAt(0);var R=this.bbox(h);for(R=R.split(" "),z=parseInt(R[0]),y=parseInt(R[1]),C=parseInt(R[2]),M=parseInt(R[3]),"S"==F&&(500==z&&500==C?(n=s.split("x"),y=500+parseInt(n[0]),M=500+parseInt(n[1])):(y=1e3-z,M=1e3-C)),I=h.match(d),f=0;f<I.length;f++)b=I[f].slice(0,6),m=I[f].slice(6,9),k=I[f].slice(10,13),t.F[f+1]&&(t.F[f+1][1]&&(m=parseInt(m)+parseInt(t.F[f+1][1].slice(0,3))-500,k=parseInt(k)+parseInt(t.F[f+1][1].slice(4,7))-500,z=Math.min(z,m),C=Math.min(C,k)),i=this.size(b),i&&(i=i.split("x"),y=Math.max(y,parseInt(m)+t.F[f+1][0]*parseInt(i[0])),M=Math.max(M,parseInt(k)+t.F[f+1][0]*parseInt(i[1]))));z-=t.pad,y+=t.pad,C-=t.pad,M+=t.pad,w=(y-z)*t.size,A=(M-C)*t.size,l.width=w,l.height=A;var E=l.getContext("2d");for(t.back&&(E.rect(0,0,w,A),E.fillStyle=t.back,E.fill()),I=h.match(d),f=0;f<I.length;f++)b=I[f].slice(0,6),m=I[f].slice(6,9),k=I[f].slice(10,13),t.F[f+1]&&(t.F[f+1][1]&&(m=parseInt(m)+parseInt(t.F[f+1][1].slice(0,3))-500,k=parseInt(k)+parseInt(t.F[f+1][1].slice(4,7))-500,z=Math.min(z,m),C=Math.min(C,k)),i=this.size(b),i&&(i=i.split("x"),y=Math.max(y,parseInt(m)+t.F[f+1][0]*parseInt(i[0])),M=Math.max(M,parseInt(k)+t.F[f+1][0]*parseInt(i[1])))),E.font=(t.F[f+1]?30*t.size*t.F[f+1][0]:30*t.size)+"px 'SignWriting 2010 Filling'",E.fillStyle=t.E[f+1]&&t.E[f+1][1]?t.E[f+1][1]:t.fill,E.fillText(this.code(b),(m-z)*t.size,(k-C)*t.size),E.font=(t.F[f+1]?30*t.size*t.F[f+1][0]:30*t.size)+"px 'SignWriting 2010'",E.fillStyle=t.E[f+1]?t.E[f+1][0]:t.colorize?"#"+this.colorize(b):t.line,E.fillText(this.code(b),(m-z)*t.size,(k-C)*t.size);return l},png:function(e,t){if(this.fsw(e,!0)||this.key(e,!0)){var a=this.canvas(e,t),r=a.toDataURL("image/png");return a.remove(),r}return""},query:function(e){return e=e.match(/Q((A(S[123][0-9a-f]{2}[0-5u][0-9a-fu]|R[123][0-9a-f]{2}t[123][0-9a-f]{2})+)?T)?((R[123][0-9a-f]{2}t[123][0-9a-f]{2}([0-9]{3}x[0-9]{3})?)|(S[123][0-9a-f]{2}[0-5u][0-9a-fu]([0-9]{3}x[0-9]{3})?))*(V[0-9]+)?/),e?e[0]:""},range:function(e,t,a){var r,s,i,n,f,c,l;if(a||(a=""),e=("000"+e).slice(-3),t=""+t,r="",e===t)return e;if(s=[],(e[0]!=t[0]||e[1]!=t[1])&&"0"!=e[2])if(r=e[0]+e[1],a){switch(e[2]){case"f":r+="f";break;case"e":r+="[ef]";break;case"d":case"c":case"b":case"a":r+="["+e[2]+"-f]";break;default:switch(e[2]){case"9":r+="[9a-f]";break;case"8":r+="[89a-f]";break;default:r+="["+e[2]+"-9a-f]"}}i=15-parseInt(e[2],16)+1,e=""+(parseInt(e,16)+i).toString(16),s.push(r)}else{switch(e[2]){case"9":r+="9";break;case"8":r+="[89]";break;default:r+="["+e[2]+"-9]"}i=9-e[2]+1,e=""+(1*e+i),s.push(r)}if(r="",e[0]!=t[0]&&"0"!=e[1])if(a){switch(r=e[0],e[1]){case"f":r+="f";break;case"e":r+="[ef]";break;case"d":case"c":case"b":case"a":r+="["+e[1]+"-f]";break;case"9":r+="[9a-f]";break;case"8":r+="[89a-f]";break;default:r+="["+e[1]+"-9a-f]"}r+="[0-9a-f]",i=15-parseInt(e[1],16)+1,e=""+(parseInt(e,16)+16*i).toString(16),s.push(r)}else{switch(r=e[0],i=9-e[1]+1,e[1]){case"9":r+="9";break;case"8":r+="[89]";break;default:r+="["+e[1]+"-9]"}r+="[0-9]",i=9-e[1]+1,e=""+(1*e+10*i),s.push(r)}if(r="",e[0]!=t[0])if(a){switch(i=parseInt(t[0],16)-parseInt(e[0],16),n=(parseInt(e[0],16)+i-1).toString(16),i){case 1:r=e[0];break;case 2:r="["+e[0]+n+"]";break;default:switch(c=parseInt(e[0],16)>9?"h":"d",l=parseInt(n,16)>9?"h":"d",c+l){case"dd":r+="["+e[0]+"-"+n+"]";break;case"dh":switch(i=9-e[0]){case 0:r+="[9";break;case 1:r+="[89";break;default:r+="["+e[0]+"-9"}switch(n[0]){case"a":r+="a]";break;case"b":r+="ab]";break;default:r+="a-"+n+"]"}break;case"hh":r+="["+e[0]+"-"+n+"]"}}r+="[0-9a-f][0-9a-f]",i=parseInt(t[0],16)-parseInt(e[0],16),e=""+(parseInt(e,16)+256*i).toString(16),s.push(r)}else{switch(i=t[0]-e[0],n=1*e[0]+i-1,i){case 1:r=e[0];break;case 2:r="["+e[0]+n+"]";break;default:r="["+e[0]+"-"+n+"]"}r+="[0-9][0-9]",e=""+(1*e+100*i),s.push(r)}if(r="",e[1]!=t[1])if(a){switch(i=parseInt(t[1],16)-parseInt(e[1],16),n=(parseInt(e[1],16)+i-1).toString(16),r=e[0],i){case 1:r+=e[1];break;case 2:r+="["+e[1]+n+"]";break;default:switch(c=parseInt(e[1],16)>9?"h":"d",l=parseInt(n,16)>9?"h":"d",c+l){case"dd":r+="["+e[1],i>1&&(r+="-"),r+=n+"]";break;case"dh":switch(i=9-e[1]){case 0:r+="[9";break;case 1:r+="[89";break;default:r+="["+e[1]+"-9"}switch(t[1]){case"a":r+="]";break;case"b":r+="a]";break;default:r+="a-"+(parseInt(t[1],16)-1).toString(16)+"]"}break;case"hh":r+="["+e[1],i>1&&(r+="-"),r+=(parseInt(t[1],16)-1).toString(16)+"]"}}r+="[0-9a-f]",i=parseInt(t[1],16)-parseInt(e[1],16),e=""+(parseInt(e,16)+16*i).toString(16),s.push(r)}else{switch(i=t[1]-e[1],n=1*e[1]+i-1,r=e[0],i){case 1:r+=e[1];break;case 2:r+="["+e[1]+n+"]";break;default:r+="["+e[1]+"-"+n+"]"}r+="[0-9]",e=""+(1*e+10*i),s.push(r)}if(r="",e[2]!=t[2])if(a){switch(r=e[0]+e[1],i=parseInt(t[2],16)-parseInt(e[2],16),c=parseInt(e[2],16)>9?"h":"d",l=parseInt(t[2],16)>9?"h":"d",c+l){case"dd":r+="["+e[2],i>1&&(r+="-"),r+=t[2]+"]";break;case"dh":switch(i=9-e[2]){case 0:r+="[9";break;case 1:r+="[89";break;default:r+="["+e[2]+"-9"}switch(t[2]){case"a":r+="a]";break;case"b":r+="ab]";break;default:r+="a-"+t[2]+"]"}break;case"hh":r+="["+e[2],i>1&&(r+="-"),r+=t[2]+"]"}i=parseInt(t[2],16)-parseInt(e[2],16),e=""+(parseInt(e,16)+i).toString(16),s.push(r)}else{switch(i=t[2]-e[2],r=e[0]+e[1],i){case 0:r+=e[2];break;case 1:r+="["+e[2]+t[2]+"]";break;default:r+="["+e[2]+"-"+t[2]+"]"}e=""+(1*e+i),s.push(r)}return r="","0"==e[2]&&"0"==t[2]&&(r=t,s.push(r)),r="",f=s.length,1==f?r=s[0]:(r=s.join(")|("),r="(("+r+"))"),r},regex:function(e,t){if(e=this.query(e),!e)return"";var a,r,s,i,n,f,c,l,h,p,o,g,u;t||(t=20);var S,d="S[123][0-9a-f]{2}[0-5][0-9a-f]",x="[0-9]{3}x[0-9]{3}",b="[BLMR]("+x+")("+d+x+")*",I="(A("+d+")+)",v="R[123][0-9a-f]{2}t[123][0-9a-f]{2}",m="S[123][0-9a-f]{2}[0-5u][0-9a-fu]",k="([0-9]{3}x[0-9]{3})?",F="(V[0-9]+)";if(e=this.query(e),!e)return"";if("Q"==e)return[I+"?"+b];if("QT"==e)return[I+b];var w=[],A=e.indexOf("T")+1;if(A){S="(A";var z=e.slice(0,A);if(e=e.replace(z,""),"QT"==z)S+="("+d+")+)";else if(a=z.match(new RegExp("("+m+"|"+v+")","g"))){for(r=0;r<a.length;r++){var y=a[r].match(new RegExp(m));y?(l=y[0].slice(0,4),g=y[0].slice(4,5),l+="u"==g?"[0-5]":g,u=y[0].slice(5,6),l+="u"==u?"[0-9a-f]":u,S+=l):(n=a[r].slice(1,4),f=a[r].slice(5,8),c=this.range(n,f,"hex"),l="S"+c+"[0-5][0-9a-f]",S+=l)}S+="("+d+")*)"}}if(a=e.match(new RegExp(F,"g")),a&&(t=1*a.toString().slice(1)),s=m+k,a=e.match(new RegExp(s,"g")))for(r=0;r<a.length;r++)i=a[r].toString(),o=i.slice(1,4),l="S"+o,g=i.slice(4,5),l+="u"==g?"[0-5]":g,u=i.slice(5,6),l+="u"==u?"[0-9a-f]":u,i.length>6?(h=1*i.slice(6,9),p=1*i.slice(10,13),l+=this.range(h-t,h+t),l+="x",l+=this.range(p-t,p+t)):l+=x,l=b+l+"("+d+x+")*",l=A?S+l:I+"?"+l,w.push(l);if(s=v+k,a=e.match(new RegExp(s,"g")))for(r=0;r<a.length;r++)i=a[r].toString(),n=i.slice(1,4),f=i.slice(5,8),c=this.range(n,f,"hex"),l="S"+c+"[0-5][0-9a-f]",i.length>8?(h=1*i.slice(8,11),p=1*i.slice(12,15),l+=this.range(h-t,h+t),l+="x",l+=this.range(p-t,p+t)):l+=x,l=b+l+"("+d+x+")*",l=A?S+l:I+"?"+l,w.push(l);return w.length||w.push(S+b),w},results:function(e,t,a){if(!t)return[];(-1==="BLMR".indexOf(a)||a.length>1)&&(a="");var r,s,i,n,f=this.regex(e);if(!f)return[];for(var c=0;c<f.length;c++)r=f[c],s=t.match(new RegExp(r,"g")),t=s?s.join(" "):"";return t?(a&&(t=t.replace(/B/g,a),t=t.replace(/L/g,a),t=t.replace(/M/g,a),t=t.replace(/R/g,a)),i=t.split(" "),n=i.filter(function(e){return e in this?!1:this[e]=!0},{})):n=[],n},lines:function(e,t,a){if(!t)return[];(-1==="BLMR".indexOf(a)||a.length>1)&&(a="");var r,s,i,n,f=this.regex(e);if(!f)return[];for(var c=0;c<f.length;c++)r=f[c],r="^"+r+".*",s=t.match(new RegExp(r,"mg")),t=s?s.join("\n"):"";return t?(a&&(t=t.replace(/B/g,a),t=t.replace(/L/g,a),t=t.replace(/M/g,a),t=t.replace(/R/g,a)),i=t.split("\n"),n=i.filter(function(e){return e in this?!1:this[e]=!0},{})):n=[],n},convert:function(e,t){var a,r="";if(this.fsw(e)&&/^[Aa]?([Ss]L?)?$/.test(t)){var s,i,n="S[123][0-9a-f]{2}",f=n+"[0-5][0-9a-f]",c="[0-9]{3}x[0-9]{3}";if((t.indexOf("A")>-1||t.indexOf("a")>-1)&&(s=e.match(new RegExp("A("+f+")*","g"))))if(i=s[0],t.indexOf("A")>-1)r+=i+"T";else{for(s=i.match(new RegExp(n,"g")),r+="A",a=0;a<s.length;a++)r+=s[a]+"uu";r+="T"}if((t.indexOf("S")>-1||t.indexOf("s")>-1)&&(s=e.match(new RegExp(f+c,"g"))))for(a=0;a<s.length;a++)r+=t.indexOf("S")>-1?s[a].slice(0,6):s[a].slice(0,4)+"uu",t.indexOf("L")>-1&&(r+=s[a].slice(6,13))}return r?"Q"+r:""}};
